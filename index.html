<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Mon Livre PDF</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif; background:#111; color:#fff; }
    #flipbook { width: 90%; height: 70vh; margin: 2rem auto; }
    .page { background: #fff; color: #000; display: inline-block; }
    .controls { text-align:center; margin-top:0.5rem; }
    .btn { padding:0.5rem 1rem; background:#444; color:#fff; border:none; cursor:pointer; border-radius:5px; margin:0 5px; }
    .btn:disabled { background: #222; cursor: not-allowed; }
  </style>
  <!-- jQuery (doit venir avant turn.js) -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJ+Y5yExlq6GSYGSHk7tPXikynSi3RvD/CM="
    crossorigin="anonymous"></script>
  <!-- turn.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/4.1.0/turn.min.js"
    integrity="sha512-FgSeBrB8jQ1Hrs0x6rM0+ASkku/EfLmiJ5iI2GmWQ3Gzy3Wry0ZFe6Vjw7rnSTZwaBsqkCUb/Dk0zBj2zOiJ1g=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <!-- pdf.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"
    integrity="sha512-3xq9QiuEyQ7TpJQYXcUNrwq30kxqvXyGfIw1MJq2X/5clml0Uu6wUuMXOoGNV7gM+PO8IW4mTQbJHap9sK+3uw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.worker.min.js"
    integrity="sha512-+fsg9xHmrz1+itL/l9K2pwsWZZ6+VCxTIkj/0t9J+mDmTLq0Pe5WZYC1GJpy2G+eNLxFhA0zHDdIHKcYTbQj8g=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>

  <h1 style="text-align:center; margin-top:1rem;">Mon Livre PDF</h1>
  <div class="controls">
    <button id="prev" class="btn" disabled>« Précédent</button>
    <button id="next" class="btn" disabled>Suivant »</button>
    <span id="status">Chargement...</span>
  </div>
  <div id="flipbook"></div>

  <script>
    // Chemin relatif vers ton PDF ; attention à la casse exacte et à l'emplacement.
    const PDF_URL = "pdf/livre.pdf"; // vérifier que /pdf/livre.pdf existe dans le repo

    const flipbookEl = $("#flipbook");
    const prevBtn = document.getElementById("prev");
    const nextBtn = document.getElementById("next");
    const statusEl = document.getElementById("status");

    // Configurer pdf.js
    pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.worker.min.js";

    let pdfDoc = null;

    async function createPageCanvas(pageNum) {
      const page = await pdfDoc.getPage(pageNum);
      const viewport = page.getViewport({ scale: 1.2 });
      const canvas = document.createElement("canvas");
      canvas.width = viewport.width;
      canvas.height = viewport.height;
      const ctx = canvas.getContext("2d");
      await page.render({ canvasContext: ctx, viewport: viewport }).promise;
      const wrapper = document.createElement("div");
      wrapper.className = "page";
      wrapper.style.width = viewport.width + "px";
      wrapper.style.height = viewport.height + "px";
      wrapper.appendChild(canvas);
      return wrapper;
    }

    async function loadPDF() {
      try {
        pdfDoc = await pdfjsLib.getDocument(PDF_URL).promise;
        const totalPages = pdfDoc.numPages;
        statusEl.textContent = `Pages : ${totalPages}`;

        // Créer toutes les pages et les insérer
        const pages = [];
        for (let i = 1; i <= totalPages; i++) {
          const pageDiv = await createPageCanvas(i);
          pages.push(pageDiv);
        }
        pages.forEach(p => flipbookEl.append(p));

        // Initialiser turn.js
        flipbookEl.turn({
          width: flipbookEl.width(),
          height: flipbookEl.height(),
          autoCenter: true,
          gradients: true,
          duration: 500
        });

        prevBtn.disabled = false;
        nextBtn.disabled = false;
        prevBtn.onclick = () => flipbookEl.turn("previous");
        nextBtn.onclick = () => flipbookEl.turn("next");
        statusEl.textContent = `Prêt — ${totalPages} pages chargées`;
      } catch (e) {
        console.error(e);
        statusEl.textContent = "Erreur de chargement du PDF : " + (e.message || e);
      }
    }

    $(document).ready(() => {
      loadPDF();
    });
  </script>
</body>
</html>
