<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Mon Livre PDF</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }
    h1 {
      text-align: center;
      margin: 25px 0 10px 0;
      font-size: 2.5em;
      letter-spacing: 1px;
    }
    .nav {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-bottom: 12px;
    }
    .nav button {
      padding: 15px 28px;
      background: #222;
      color: #fff;
      border: none;
      border-radius: 12px;
      font-size: 1.4em;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s;
    }
    .nav button:active {
      background: #333;
    }
    .nav button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .nav #status {
      font-size: 1.3em;
      margin-left: 15px;
      min-width: 110px;
      display: inline-block;
    }
    #viewer-container {
      width: 100vw;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #viewer {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0 auto;
      background: transparent;
      min-height: 70vh;
    }
    canvas {
      box-shadow: 0 2px 12px #000c;
      margin: 4px;
      background: #fff;
      border-radius: 8px;
      width: 100%;
      height: auto;
      max-width: 96vw;
      max-height: 78vh;
      object-fit: contain;
    }
    @media (max-width: 700px) {
      h1 { font-size: 1.3em; }
      .nav button { padding: 7px 13px; font-size: 1em; }
      .nav #status { font-size: 1em; min-width: 75px;}
      #viewer { min-height: 50vh;}
    }
  </style>
</head>
<body>
  <h1>Mon Livre PDF</h1>
  <div class="nav">
    <button id="prev">« Précédent</button>
    <button id="next">Suivant »</button>
    <button id="fullscreen">Plein écran ⛶</button>
    <span id="status">Chargement…</span>
  </div>
  <div id="viewer-container">
    <div id="viewer"></div>
  </div>
  <script src="libs/jquery.min.js"></script>
  <script src="libs/pdf.js"></script>
  <script>
    // Détection du mode d'affichage : single (portrait) ou double (paysage)
    function getDisplayMode() {
      return (window.innerWidth > window.innerHeight || window.innerWidth > 900) ? "double" : "single";
    }
    // Gestion PDF.js
    pdfjsLib.GlobalWorkerOptions.workerSrc = "libs/pdf.worker.js";
    const url = "pdf/livre.pdf";
    const viewer = document.getElementById("viewer");
    const status = document.getElementById("status");
    const prevBtn = document.getElementById("prev");
    const nextBtn = document.getElementById("next");
    const fullscreenBtn = document.getElementById("fullscreen");
    let pdfDoc = null, currentPage = 1, numPages = 0, mode = getDisplayMode();
    // Affichage d'une ou deux pages selon mode
    function renderPages(pageNum, mode) {
      viewer.innerHTML = ""; // Efface les anciennes pages
      if(mode === "double") {
        let left = pageNum, right = Math.min(pageNum+1, numPages);
        [left, right].forEach(function(p, idx){
          if(p <= numPages) {
            pdfDoc.getPage(p).then(function(page){
              let canvas = document.createElement("canvas");
              viewer.appendChild(canvas);
              let context = canvas.getContext("2d");
              let viewport = page.getViewport({scale: window.devicePixelRatio > 1 ? 1.2 : 1});
              // Pour que les deux canvases tiennent dans l'écran
              if(viewer.offsetWidth > 0 && idx===0) {
                let maxW = viewer.offsetWidth/2.1; // marge
                if(viewport.width > maxW) viewport = page.getViewport({scale: maxW/viewport.width});
              }
              canvas.height = viewport.height;
              canvas.width = viewport.width;
              page.render({canvasContext: context, viewport: viewport});
            });
          }
        });
        status.textContent = `Page ${left}${right>left?("-"+right):""} / ${numPages}`;
      } else {
        pdfDoc.getPage(pageNum).then(function(page){
          let canvas = document.createElement("canvas");
          viewer.appendChild(canvas);
          let context = canvas.getContext("2d");
          let viewport = page.getViewport({scale: window.devicePixelRatio > 1 ? 1.2 : 1});
          // Max width on mobile
          if(viewer.offsetWidth > 0 && viewport.width > viewer.offsetWidth) {
            viewport = page.getViewport({scale: viewer.offsetWidth/viewport.width});
          }
          canvas.height = viewport.height;
          canvas.width = viewport.width;
          page.render({canvasContext: context, viewport: viewport});
        });
        status.textContent = `Page ${pageNum} / ${numPages}`;
      }
      // Boutons enable/disable
      if(mode==="double") {
        prevBtn.disabled = (currentPage <= 1);
        nextBtn.disabled = (currentPage + 1 > numPages);
      } else {
        prevBtn.disabled = (currentPage <= 1);
        nextBtn.disabled = (currentPage >= numPages);
      }
    }
    // Suivant / Précédent
    prevBtn.onclick = function() {
      if(mode==="double") {
        if(currentPage>2) { currentPage -= 2; } else { currentPage = 1; }
      } else {
        if(currentPage>1) currentPage -= 1;
      }
      renderPages(currentPage, mode);
    };
    nextBtn.onclick = function() {
      if(mode==="double") {
        if(currentPage+1<numPages) { currentPage += 2; }
        else if(currentPage<numPages) { currentPage = numPages; }
      } else {
        if(currentPage<numPages) currentPage += 1;
      }
      renderPages(currentPage, mode);
    };
    // Gestion plein écran
    fullscreenBtn.onclick = function() {
      const el = document.documentElement;
      if (el.requestFullscreen) el.requestFullscreen();
      else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
      else if (el.msRequestFullscreen) el.msRequestFullscreen();
    };
    // Touch events pour slide page
    let touchStartX = 0;
    viewer.addEventListener("touchstart", function(e){
      if(e.touches.length===1) touchStartX = e.touches[0].clientX;
    });
    viewer.addEventListener("touchend", function(e){
      if(e.changedTouches.length===1) {
        let dx = e.changedTouches[0].clientX - touchStartX;
        if(Math.abs(dx)>50) {
          if(dx>0) prevBtn.click(); else nextBtn.click();
        }
      }
    });
    // Gestion du resize/orientation
    window.addEventListener("resize", function(){
      let newMode = getDisplayMode();
      if(newMode!==mode) { mode = newMode; renderPages(currentPage, mode);}
    });
    // Chargement initial PDF
    pdfjsLib.getDocument(url).promise.then(function(pdf) {
      pdfDoc = pdf;
      numPages = pdfDoc.numPages;
      mode = getDisplayMode();
      // Pour les pages paires en double page, commence sur page impaire
      if(mode==="double" && currentPage%2===0) currentPage--;
      renderPages(currentPage, mode);
      status.textContent = numPages+" pages";
    }, function(error) {
      status.textContent = "Erreur PDF: "+error.message;
    });
  </script>
</body>
</html>
