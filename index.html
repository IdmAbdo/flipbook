<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Mon Livre PDF</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg:#111;
      --btn-bg:#444;
      --btn-color:#fff;
      --radius:12px;
    }
    *{box-sizing:border-box;}
    body {
      margin:0;
      background: var(--bg);
      color:#fff;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
    }
    h1 {
      margin:0;
      padding:16px 0 4px;
      font-size:2.2rem;
      text-align:center;
    }
    #controls {
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      justify-content:center;
      align-items:center;
      padding:8px;
      margin-bottom:8px;
      position:relative;
      width:100%;
      max-width:1100px;
    }
    button {
      background: var(--btn-bg);
      border:none;
      padding:14px 24px;
      border-radius:8px;
      cursor:pointer;
      font-size:1rem;
      color: var(--btn-color);
      position:relative;
      min-width:120px;
      display:flex;
      align-items:center;
      gap:6px;
      transition:filter .2s;
    }
    button:active {filter:brightness(.9);}
    button:disabled {opacity:.5; cursor:not-allowed;}
    #status {
      margin-left:auto;
      font-size:1.2rem;
      white-space:nowrap;
    }
    #flipbook-wrapper {
      flex:1;
      width:100%;
      display:flex;
      justify-content:center;
      padding:16px;
      overflow:auto;
    }
    #flipbook {
      width:100%;
      max-width:1000px;
      height:0;
      padding-bottom:65%; /* ratio approximatif pour page */
      position:relative;
      margin:0 auto;
    }
    .page {
      background:#fff;
      border-radius:12px;
      box-shadow:0 16px 40px rgba(0,0,0,.5);
      overflow:hidden;
    }
    .page canvas {
      display:block;
      width:100%;
      height:100%;
    }
    /* full screen style */
    .fullscreen {
      position:fixed !important;
      top:0; left:0;
      width:100% !important;
      height:100% !important;
      padding:0 !important;
      background:#000;
      z-index:9999;
    }
    .centered {
      margin:0 auto;
    }
  </style>
</head>
<body>
  <h1>Mon Livre PDF</h1>
  <div id="controls">
    <button id="prevBtn">« Précédent</button>
    <button id="nextBtn">Suivant »</button>
    <button id="fsBtn">Plein écran ⛶</button>
    <div id="status">Chargement...</div>
  </div>
  <div id="flipbook-wrapper">
    <div id="flipbook"></div>
  </div>

  <!-- Librairies -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJ+Y2jzU5tGJo7WfQZrF7rQ2mQ0Ujv+g2X0M=" crossorigin="anonymous"></script>
  <!-- turn.js : si CDN tombe, tu mets ton local: libs/turn.min.js -->
  <script src="https://cdn.jsdelivr.net/gh/blasten/turn.js@4.1.0/turn.min.js"></script>
  <!-- pdf.js officiel (version stable) -->
  <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>

  <script>
    // config pdf.js worker (si tu hérites localement, adapte url)
    if (window.pdfjsLib) {
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://mozilla.github.io/pdf.js/build/pdf.worker.js';
    }

    const url = 'pdf/livre.pdf'; // chemin relatif
    let pdfDoc = null;
    let currentPage = 1;
    let pageCount = 0;

    function getDisplayMode() {
      // double en large, single en étroit
      return (window.innerWidth > window.innerHeight) ? 2 : 1;
    }

    function updateStatus() {
      const disp = getDisplayMode();
      let text;
      if (disp === 2) {
        text = `Page ${currentPage}-${Math.min(currentPage+1,pageCount)} / ${pageCount}`;
      } else {
        text = `Page ${currentPage} / ${pageCount}`;
      }
      $('#status').text(text);
      $('#prevBtn').prop('disabled', currentPage <= 1);
      $('#nextBtn').prop('disabled', currentPage >= pageCount - (getDisplayMode()===2?1:0));
    }

    function initFlipbook() {
      // détruit si déjà existant
      if ($('#flipbook').data('turn')) {
        $('#flipbook').turn('destroy');
        $('#flipbook').empty();
      }
      // on reconstruit les pages visibles (on montre tout pour flipbook)
      const disp = getDisplayMode();
      // chaque page est une div.page
      for (let i = 1; i <= pageCount; i++) {
        const pageDiv = $('<div class="page" />').css({
          width: disp === 2 ? '50%' : '100%',
          height: '100%'
        });
        // canvas sera inséré plus tard par rendu
        pageDiv.attr('data-page', i);
        $('#flipbook').append(pageDiv);
      }

      // initialisation turn.js
      $('#flipbook').turn({
        width: $('#flipbook').width(),
        height: $('#flipbook').height(),
        display: disp === 2 ? 'double' : 'single',
        autoCenter: true,
        acceleration: true,
        gradients: true,
        elevation: 50,
        when: {
          turned: function(event, page) {
            currentPage = page;
            // si affichage double et qu'on est sur page paire: afficher paire-impair logique
            if (getDisplayMode() === 2 && currentPage % 2 === 0) {
              // turn.js fuse deux pages: on garde la première affichée en pair comme tel
            }
            updateStatus();
          }
        }
      });

      // forcer affichage initial
      $('#flipbook').turn('page', currentPage);
      updateStatus();
      renderVisiblePages(); // dessine ce qu'il faut
    }

    function renderPage(pageNum) {
      const pageDiv = $(`.page[data-page=${pageNum}]`);
      if (!pageDiv.length) return;
      // si déjà rendu, skip
      if (pageDiv.data('rendered')) return;

      pdfDoc.getPage
