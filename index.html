<!DOCTYPE html><html lang="fr"><meta charset="utf-8">
<title>Flipbook</title><meta name=viewport content="width=device-width,initial-scale=1">
<style>body{margin:0;background:#111;color:#fff;font-family:sans-serif;overflow:hidden}
h1{text-align:center;margin:8px 0;font-size:clamp(22px,6vw,36px)}
.bar{display:flex;justify-content:center;gap:8px;flex-wrap:wrap}
button{padding:8px 16px;background:#444;border:0;color:#fff;border-radius:4px}
button:disabled{opacity:.4}#status{align-self:center}
#wrap{display:flex;justify-content:center;height:calc(100vh - 96px)}
#flip{display:none;background:#222}</style>
<body><h1>Mon Livre PDF</h1>
<div class=bar><button id=p>&laquo; Précédent</button><button id=n>Suivant &raquo;</button><button id=fs>Plein&nbsp;écran&nbsp;⤢</button><span id=status>Chargement…</span></div>
<div id=wrap><div id=flip></div></div>

<script src="libs/jquery.min.js"></script>
<script src="libs/turn.min.js"></script>
<script src="libs/pdf.min.js"></script>
<script src="libs/pdf.worker.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc='libs/pdf.worker.min.js';
const url='pdf/livre.pdf',flip=$("#flip"),s=$("#status"),p=$("#p"),n=$("#n");
let doc,total,zoom=1;

const two=()=>innerWidth>=768||matchMedia('(orientation:landscape)').matches;
function scale(v){const W=innerWidth-32,H=innerHeight-96,pp=two()?2:1;
const byW=(W/pp)/v.width,byH=H/v.height;return(pp==1?byW:Math.min(byW,byH))*zoom}

async function page(i){
 const pg=await doc.getPage(i),v0=pg.getViewport({scale:1}),
 sc=scale(v0),vp=pg.getViewport({scale:sc}),c=document.createElement('canvas');
 c.width=vp.width;c.height=vp.height;
 await pg.render({canvasContext:c.getContext('2d'),viewport:vp}).promise;return c;}

async function build(){
 try{flip.turn('destroy').empty()}catch{} zoom=1;s.text('Chargement…');
 if(!doc){doc=await pdfjsLib.getDocument(url).promise;total=doc.numPages;}
 for(let i=1;i<=total;i++)flip.append($('<div>').append(await page(i)));
 const c=flip.find('canvas')[0];flip.turn({display:two()?'double':'single',
 width:c.width*(two()?2:1),height:c.height,autoCenter:!0}).show();
 s.text(total+' pages');p.prop('disabled',!1);n.prop('disabled',!1);}
p.on('click',()=>flip.turn('previous'));n.on('click',()=>flip.turn('next'));
flip.on('dblclick',()=>{zoom=zoom==1?1.4:1;build()});
fs.onclick=()=>{(document.fullscreenElement?document.exitFullscreen:document.documentElement.requestFullscreen)();}
addEventListener('resize',build);build();
</script>
